<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRILink Pro v3.3 - Master Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .active-nav { background: #1e40af; color: white; box-shadow: 0 10px 15px -3px rgba(30, 64, 175, 0.3); }
        .page { display: none; animation: fadeIn 0.3s ease-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <div id="modal-login" class="fixed inset-0 z-[100] bg-slate-900 flex items-center justify-center p-6" style="display: none;">
        <div class="bg-white p-8 rounded-[2.5rem] w-full max-w-md shadow-2xl text-center">
            <h2 class="text-xl font-800 text-slate-800 mb-8 uppercase">Login Petugas</h2>
            <div class="space-y-3">
                <input type="email" id="login-email" placeholder="Email" class="w-full p-4 bg-slate-100 rounded-2xl outline-none font-bold">
                <input type="password" id="login-pass" placeholder="Password" class="w-full p-4 bg-slate-100 rounded-2xl outline-none font-bold">
                <button id="btn-login-action" class="w-full bg-blue-600 text-white font-800 py-4 rounded-2xl shadow-lg">MASUK</button>
            </div>
        </div>
    </div>

    <div id="modal-session" class="fixed inset-0 z-[90] bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-4" style="display: none;">
        <div class="bg-white p-8 rounded-[2.5rem] w-full max-w-lg shadow-2xl overflow-y-auto max-h-[90vh]">
            <h2 class="text-lg font-800 mb-6 italic uppercase">Buka Sesi & Opname Saldo</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6">
                <div class="p-3 bg-slate-50 rounded-2xl border"><label class="text-[8px] font-800 text-slate-400 uppercase">Laci</label><input type="number" id="start-laci" value="0" class="w-full bg-transparent font-black outline-none text-blue-700"></div>
                <div class="p-3 bg-slate-50 rounded-2xl border"><label class="text-[8px] font-800 text-slate-400 uppercase">BRI</label><input type="number" id="start-bri" value="0" class="w-full bg-transparent font-black outline-none text-blue-700"></div>
                <div class="p-3 bg-slate-50 rounded-2xl border"><label class="text-[8px] font-800 text-slate-400 uppercase">DANA</label><input type="number" id="start-dana" value="0" class="w-full bg-transparent font-black outline-none text-blue-700"></div>
                <div class="p-3 bg-slate-50 rounded-2xl border"><label class="text-[8px] font-800 text-slate-400 uppercase">PULSA</label><input type="number" id="start-pulsa" value="0" class="w-full bg-transparent font-black outline-none text-blue-700"></div>
            </div>
            <button id="btn-start-session" class="w-full bg-blue-600 text-white font-800 py-4 rounded-2xl shadow-xl">MULAI KASIR</button>
        </div>
    </div>

    <div id="app-content" class="flex flex-col md:flex-row min-h-screen" style="display: none;">
        
        <aside class="hidden md:flex flex-col w-64 bg-slate-900 text-white p-6 sticky top-0 h-screen">
            <h1 class="text-xl font-800 italic mb-10">BRILink <span class="text-yellow-400">PRO</span></h1>
            <nav class="space-y-2 flex-1">
                <button onclick="nav('page-home')" class="nav-btn w-full flex items-center gap-4 p-4 text-xs font-bold rounded-2xl active-nav" data-page="page-home"><i class="fas fa-th-large"></i> Dashboard</button>
                <button onclick="nav('page-master')" class="nav-btn w-full flex items-center gap-4 p-4 text-xs font-bold rounded-2xl" data-page="page-master"><i class="fas fa-database"></i> Master Data</button>
                <button onclick="nav('page-history')" class="nav-btn w-full flex items-center gap-4 p-4 text-xs font-bold rounded-2xl" data-page="page-history"><i class="fas fa-history"></i> Riwayat</button>
                <button onclick="nav('page-debt')" class="nav-btn w-full flex items-center gap-4 p-4 text-xs font-bold rounded-2xl" data-page="page-debt"><i class="fas fa-user-clock"></i> Hutang</button>
            </nav>
            <button id="btn-end-session" class="bg-red-500/10 text-red-400 p-4 rounded-2xl text-[10px] font-800 mt-auto">TUTUP KASIR</button>
        </aside>

        <main class="flex-1 pb-24 md:pb-8 overflow-y-auto">
            <header class="bg-white/80 backdrop-blur-md border-b p-4 md:p-6 sticky top-0 z-40 flex justify-between items-center">
                <h2 id="page-title" class="text-sm font-800 text-slate-800 uppercase tracking-tighter">Dashboard</h2>
                <p id="user-display" class="text-[10px] font-800 text-blue-600 bg-blue-50 px-3 py-1 rounded-full uppercase leading-none"></p>
            </header>

            <div class="p-4 md:p-8 max-w-5xl mx-auto space-y-6">
                
                <div id="page-home" class="page active space-y-6">
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                        <div class="bg-blue-600 p-4 rounded-3xl text-white shadow-lg"><p class="text-[8px] font-bold opacity-60 uppercase mb-1">Laci</p><h3 id="stat-laci" class="text-md font-800">Rp 0</h3></div>
                        <div class="bg-white p-4 rounded-3xl border shadow-sm"><p class="text-[8px] font-bold text-slate-400 uppercase mb-1">BRI</p><h3 id="stat-bri" class="text-md font-800 text-blue-700">Rp 0</h3></div>
                        <div class="bg-white p-4 rounded-3xl border shadow-sm"><p class="text-[8px] font-bold text-slate-400 uppercase mb-1">DANA</p><h3 id="stat-dana" class="text-md font-800 text-blue-500">Rp 0</h3></div>
                        <div class="bg-white p-4 rounded-3xl border shadow-sm"><p class="text-[8px] font-bold text-slate-400 uppercase mb-1">Pulsa</p><h3 id="stat-pulsa" class="text-md font-800 text-orange-600">Rp 0</h3></div>
                    </div>

                    <div class="bg-white p-6 md:p-8 rounded-[2.5rem] border shadow-sm max-w-xl mx-auto">
                        <div class="flex gap-1 mb-6 bg-slate-100 p-1 rounded-2xl overflow-x-auto hide-scrollbar">
                            <button onclick="setType('TRANSFER')" id="t-TRANSFER" class="flex-1 py-3 text-[9px] font-800 rounded-xl bg-white shadow text-blue-700">TRANSFER</button>
                            <button onclick="setType('TARIK')" id="t-TARIK" class="flex-1 py-3 text-[9px] font-800 rounded-xl text-slate-400 uppercase">Tarik</button>
                            <button onclick="setType('PULSA')" id="t-PULSA" class="flex-1 py-3 text-[9px] font-800 rounded-xl text-slate-400 uppercase">Pulsa/Data</button>
                        </div>

                        <div class="space-y-4">
                            <div id="box-search-produk" class="hidden space-y-2">
                                <label class="text-[9px] font-800 text-slate-400 uppercase ml-2">Cari Produk Master</label>
                                <input type="text" id="inp-search-produk" placeholder="Ketik nama produk..." class="w-full p-4 bg-blue-50 rounded-2xl font-bold outline-none border border-blue-100 shadow-inner">
                                <div id="search-results" class="max-h-40 overflow-y-auto hidden border rounded-2xl bg-white divide-y"></div>
                            </div>

                            <div id="box-nominal-manual" class="space-y-4">
                                <div class="space-y-1">
                                    <label class="text-[9px] font-800 text-slate-400 uppercase ml-2">Nominal / Harga Jual</label>
                                    <input type="number" id="inp-nominal" placeholder="Rp 0" class="w-full p-4 bg-slate-50 rounded-2xl text-2xl font-800 outline-none border">
                                </div>
                                <div id="box-modal" class="hidden grid grid-cols-2 gap-3">
                                    <div class="p-3 bg-orange-50 rounded-2xl border border-orange-100">
                                        <label class="text-[8px] font-800 text-orange-400 uppercase">Harga Modal</label>
                                        <input type="number" id="inp-modal-manual" value="0" class="w-full bg-transparent font-bold outline-none">
                                    </div>
                                    <div class="p-3 bg-slate-50 rounded-2xl border flex items-center justify-center italic text-[10px] text-slate-400">Manual Input</div>
                                </div>
                                <div id="box-admin" class="grid grid-cols-2 gap-3">
                                    <div class="p-3 bg-slate-50 rounded-2xl border">
                                        <label class="text-[8px] font-800 text-slate-400 uppercase">Admin Cust</label>
                                        <input type="number" id="inp-admin" value="5000" class="w-full bg-transparent font-bold outline-none">
                                    </div>
                                    <div class="p-3 bg-slate-50 rounded-2xl border">
                                        <label class="text-[8px] font-800 text-slate-400 uppercase">Biaya Bank</label>
                                        <input type="number" id="inp-biaya" value="3000" class="w-full bg-transparent font-bold outline-none">
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 p-4 bg-slate-50 rounded-2xl border cursor-pointer">
                                <input type="checkbox" id="inp-hutang" class="w-5 h-5 accent-blue-600"><label for="inp-hutang" class="text-[10px] font-800 text-slate-600 uppercase tracking-tighter leading-none mt-1">Simpan Sebagai Hutang</label>
                            </div>

                            <button id="btn-save" class="w-full bg-slate-900 text-white font-800 py-5 rounded-2xl shadow-xl hover:bg-blue-600 transition-all uppercase text-[10px] tracking-widest">Simpan Transaksi</button>
                        </div>
                    </div>
                </div>

                <div id="page-master" class="page space-y-6">
                    <div class="bg-white p-6 rounded-[2rem] border shadow-sm">
                        <h3 class="text-xs font-800 uppercase mb-6 tracking-widest">Tambah Produk Baru</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                            <input type="text" id="m-nama" placeholder="Nama Produk (Contoh: TSEL 10K)" class="p-4 bg-slate-50 rounded-2xl text-xs font-bold outline-none border focus:ring-2 ring-blue-100">
                            <input type="number" id="m-modal" placeholder="Harga Modal" class="p-4 bg-slate-50 rounded-2xl text-xs font-bold outline-none border focus:ring-2 ring-blue-100">
                            <input type="number" id="m-jual" placeholder="Harga Jual" class="p-4 bg-slate-50 rounded-2xl text-xs font-bold outline-none border focus:ring-2 ring-blue-100">
                        </div>
                        <button id="btn-add-master" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-800 text-[10px] uppercase shadow-lg">Simpan Ke Master</button>
                    </div>

                    <div class="bg-white rounded-[2rem] border overflow-hidden shadow-sm">
                        <table class="w-full text-left text-xs">
                            <thead class="bg-slate-50 text-slate-400 font-800 uppercase">
                                <tr>
                                    <th class="p-4">Nama Produk</th>
                                    <th class="p-4">Modal</th>
                                    <th class="p-4">Jual</th>
                                    <th class="p-4">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="list-master-body" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>

                <div id="page-history" class="page space-y-4">
                    <div id="list-history" class="grid gap-3"></div>
                </div>
                <div id="page-debt" class="page space-y-4">
                    <div id="list-debt" class="grid gap-3"></div>
                </div>

            </div>
        </main>

        <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t px-6 py-4 flex justify-between items-center z-50 rounded-t-3xl shadow-2xl">
            <button onclick="nav('page-home')" class="flex flex-col items-center gap-1 text-blue-600"><i class="fas fa-home"></i><span class="text-[7px] font-800 uppercase">Home</span></button>
            <button onclick="nav('page-master')" class="flex flex-col items-center gap-1 text-slate-300"><i class="fas fa-database"></i><span class="text-[7px] font-800 uppercase">Master</span></button>
            <button onclick="nav('page-history')" class="flex flex-col items-center gap-1 text-slate-300"><i class="fas fa-history"></i><span class="text-[7px] font-800 uppercase">Riwayat</span></button>
            <button onclick="nav('page-debt')" class="flex flex-col items-center gap-1 text-slate-300"><i class="fas fa-user-clock"></i><span class="text-[7px] font-800 uppercase">Hutang</span></button>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDFUlHciJ3ms6bViuLbog2J66-k-oF4DLM",
            authDomain: "brilink-jaman-now.firebaseapp.com",
            databaseURL: "https://brilink-jaman-now-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "brilink-jaman-now",
            storageBucket: "brilink-jaman-now.firebasestorage.app",
            messagingSenderId: "856199740278",
            appId: "1:856199740278:web:95066429f78e87d9d49857"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const rtdb = getDatabase(app);

        let activeType = 'TRANSFER';
        let state = JSON.parse(localStorage.getItem('brilink_pro_v3_3')) || {
            session: { active: false },
            saldo: { laci: 0, bri: 0, dana: 0, pulsa: 0, hutang: 0 },
            logs: [],
            master_data: [] // [{nama, modal, jual}]
        };

        // NAV
        window.nav = (id) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('page-title').innerText = id.replace('page-', '').toUpperCase();
            renderUI();
        };

        // TYPE SWITCHER
        window.setType = (type) => {
            activeType = type;
            const searchBox = document.getElementById('box-search-produk');
            const adminBox = document.getElementById('box-admin');
            const modalBox = document.getElementById('box-modal');
            
            ['TRANSFER', 'TARIK', 'PULSA'].forEach(t => {
                document.getElementById('t-'+t).className = t === type ? 'flex-1 py-3 text-[9px] font-800 rounded-xl bg-white shadow text-blue-700' : 'flex-1 py-3 text-[9px] font-800 rounded-xl text-slate-400 uppercase';
            });

            if(type === 'PULSA') {
                searchBox.classList.remove('hidden');
                modalBox.classList.remove('hidden');
                adminBox.classList.add('hidden');
            } else {
                searchBox.classList.add('hidden');
                modalBox.classList.add('hidden');
                adminBox.classList.remove('hidden');
            }
        };

        // MASTER DATA LOGIC
        document.getElementById('btn-add-master').addEventListener('click', () => {
            const nama = document.getElementById('m-nama').value;
            const modal = parseFloat(document.getElementById('m-modal').value) || 0;
            const jual = parseFloat(document.getElementById('m-jual').value) || 0;
            if(!nama) return alert("Nama produk wajib!");
            state.master_data.push({ nama, modal, jual });
            save();
            document.getElementById('m-nama').value = '';
            document.getElementById('m-modal').value = '';
            document.getElementById('m-jual').value = '';
        });

        window.deleteMaster = (idx) => {
            state.master_data.splice(idx, 1);
            save();
        };

        // SEARCH PRODUCT LOGIC
        document.getElementById('inp-search-produk').addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            const resultsBox = document.getElementById('search-results');
            if(!val) return resultsBox.classList.add('hidden');

            const filtered = state.master_data.filter(p => p.nama.toLowerCase().includes(val));
            resultsBox.innerHTML = filtered.map(p => `
                <div onclick="pickProduct('${p.nama}', ${p.modal}, ${p.jual})" class="p-4 hover:bg-blue-50 cursor-pointer flex justify-between">
                    <span class="font-800 text-xs">${p.nama}</span>
                    <span class="text-[10px] text-blue-600 font-bold tracking-tighter">Rp ${p.jual.toLocaleString()}</span>
                </div>
            `).join('');
            resultsBox.classList.remove('hidden');
        });

        window.pickProduct = (nama, modal, jual) => {
            document.getElementById('inp-search-produk').value = nama;
            document.getElementById('inp-nominal').value = jual;
            document.getElementById('inp-modal-manual').value = modal;
            document.getElementById('search-results').classList.add('hidden');
        };

        // SAVE TRANSACTION
        document.getElementById('btn-save').addEventListener('click', () => {
            const isHutang = document.getElementById('inp-hutang').checked;
            let nom = parseFloat(document.getElementById('inp-nominal').value) || 0;
            let laba = 0, adm = 0;

            if (activeType === 'PULSA') {
                const modal = parseFloat(document.getElementById('inp-modal-manual').value) || 0;
                laba = nom - modal;
                state.saldo.pulsa -= modal;
                if(!isHutang) state.saldo.laci += nom;
            } else {
                adm = parseFloat(document.getElementById('inp-admin').value) || 0;
                const bia = parseFloat(document.getElementById('inp-biaya').value) || 0;
                if(activeType === 'TRANSFER') {
                    laba = adm - bia;
                    state.saldo.bri -= (nom + bia);
                    if(!isHutang) state.saldo.laci += (nom + adm);
                } else {
                    laba = adm;
                    state.saldo.bri += nom;
                    state.saldo.laci -= (nom - adm);
                }
            }

            if(isHutang) state.saldo.hutang += (activeType === 'TRANSFER' ? nom + adm : nom);

            state.logs.push({ id: Date.now(), type: activeType, nominal: nom, laba, isHutang, waktu: new Date().toLocaleTimeString('id-ID') });
            save();
            alert("Transaksi Berhasil!");
        });

        // CORE UTILS
        function save() {
            localStorage.setItem('brilink_pro_v3_3', JSON.stringify(state));
            renderUI();
        }

        function renderUI() {
            document.getElementById('stat-laci').innerText = "Rp " + state.saldo.laci.toLocaleString();
            document.getElementById('stat-bri').innerText = "Rp " + state.saldo.bri.toLocaleString();
            document.getElementById('stat-dana').innerText = "Rp " + state.saldo.dana.toLocaleString();
            document.getElementById('stat-pulsa').innerText = "Rp " + state.saldo.pulsa.toLocaleString();

            const masterBody = document.getElementById('list-master-body');
            masterBody.innerHTML = state.master_data.map((p, i) => `
                <tr class="hover:bg-slate-50">
                    <td class="p-4 font-bold text-slate-700">${p.nama}</td>
                    <td class="p-4 text-slate-400">Rp ${p.modal.toLocaleString()}</td>
                    <td class="p-4 text-blue-600 font-bold">Rp ${p.jual.toLocaleString()}</td>
                    <td class="p-4"><button onclick="deleteMaster(${i})" class="text-red-400 p-2"><i class="fas fa-trash"></i></button></td>
                </tr>
            `).join('');

            const histList = document.getElementById('list-history');
            histList.innerHTML = state.logs.slice().reverse().map(l => `
                <div class="bg-white p-4 rounded-2xl border flex justify-between items-center">
                    <div><p class="text-[9px] font-800 text-slate-400 uppercase">${l.type}</p><h4 class="font-800 text-sm">Rp ${l.nominal.toLocaleString()}</h4></div>
                    <div class="text-right"><p class="text-[8px] font-bold text-slate-400 uppercase">Laba</p><p class="text-xs font-800 text-green-600">Rp ${l.laba.toLocaleString()}</p></div>
                </div>
            `).join('');
        }

        // INIT AUTH & SESSION
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('modal-login').style.display = 'none';
                document.getElementById('app-content').style.display = 'flex';
                document.getElementById('user-display').innerText = user.email.split('@')[0];
                if(!state.session.active) document.getElementById('modal-session').style.display = 'flex';
                renderUI();
            } else {
                document.getElementById('modal-login').style.display = 'flex';
            }
        });

        document.getElementById('btn-login-action').addEventListener('click', async () => {
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-pass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } catch(err) { alert("Error!"); }
        });

        document.getElementById('btn-start-session').addEventListener('click', () => {
            state.saldo.laci = parseFloat(document.getElementById('start-laci').value) || 0;
            state.saldo.bri = parseFloat(document.getElementById('start-bri').value) || 0;
            state.saldo.dana = parseFloat(document.getElementById('start-dana').value) || 0;
            state.saldo.pulsa = parseFloat(document.getElementById('start-pulsa').value) || 0;
            state.session.active = true;
            document.getElementById('modal-session').style.display = 'none';
            save();
        });
    </script>
</body>
</html>
